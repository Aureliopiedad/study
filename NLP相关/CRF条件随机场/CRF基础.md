# 条件随机场-CRF

## 介绍

条件随机场（conditional random field，简称 CRF），是一种鉴别式几率模型，是随机场的一种，常用于标注或分析序列资料，如自然语言文字或是生物序列。

## 前置了解

### 马尔可夫过程

[定义](https://zh.wikipedia.org/wiki/%E9%A6%AC%E5%8F%AF%E5%A4%AB%E9%81%8E%E7%A8%8B#%E6%95%B8%E5%AD%B8%E6%A8%A1%E5%9E%8B)

### 隐马尔可夫模型

[定义](https://zh.wikipedia.org/wiki/%E9%9A%90%E9%A9%AC%E5%B0%94%E5%8F%AF%E5%A4%AB%E6%A8%A1%E5%9E%8B#%E5%AE%9A%E4%B9%89)

### 随机场

[定义](https://zh.wikipedia.org/wiki/%E9%9A%8F%E6%9C%BA%E5%9C%BA)，说人话，就是给定一组随机变量，每个随机变量都可以在另一个集合中随机取值，认为是一个随机场。

在概率论中，由样本空间$Ω = \{0, 1, ..., G − 1\}^n$
取样构成的随机变量$X_i$所组成的$S = \{X_1, ..., X_n\}$。若对所有的$ω\inΩ$均满足$π(ω) > 0$，则称π为一个随机场。

### 马尔可夫随机场

具有马尔可夫性质的随机场。可以认为是随机场的特例，随机场中某个位置的取值只和相邻的位置的取值有关系。

### 条件随机场

假设X和Y是随机变量，P(Y|X)指的是给定X条件下Y条件的发生概率分布，Y构成了一个由无向图G=(V,E)表示的随机场。

当：$P(Y_v|X,\{Y_w:w \neq v\})=P(Y_v|X,\{Y_w:w \sim v\})$对任意顶点v成立时，称条件概率P(Y|X)为条件随机场。其中$w \sim v$表示在图G=(V,E)中和顶点v有边相连的所有顶点w，$w \neq v$表示顶点v以外的所有顶点，$Y_w Y_v$表示顶点w和v对应的随机变量。

### 线性链条件随机场

假设$X = (X_1,X_2,...,X_n), Y = (Y_1,Y_2,...,Y_n)$均为线性表示的随机变量序列，在给定随机变量序列X的情况下，随机变量序列Y的条件概率分布P(Y|X)若满足：$P(Y_i|X,Y_1,...,Y_{i-1},Y_{i+1},...,Y_n)=P(Y_i|X,Y_{i-1},Y_{i+1})$，则称P(Y|X)为线性链条件随机场。其中i=1,2,...,n，在i=1和n时只考虑单条边。

## 理解

用词性标注简单地理解一下条件随机场，为了简单理解，这里粗略认为词性标注只与前一个词相关。

在CRF中，特征函数需要以下几个输入：

- 一个句子: $s$
- 当前单词在句子中的位置: $i$
- 当前单词在句子中的词性: $l_i$
- 上一个单词在句子中的词性: $l_{i-1}$

并输出一个数值，通常是0或1。

接下来，需要给每个特征函数$f_j$一个权重$λ_j$，可以通过将句子中的所有单词的加权特征相加来给句子评分：

$$
score(l|s) = \underbrace{\sum_{j=1}^m \overbrace{\sum_{i=1}^n λ_j f_j(s,i,l_i,l_{i-1})}^{在某个特征函数作用下整个句子中所有单词的加权结果的累加和}}_{所有特征函数作用下整个句子中所有单词的加权结果的累加和}
$$

其中，特征函数$f_j$可以分成两种类型：

1. 定义在边上的特征函数，称为转移特征，依赖于当前和前一个位置
2. 定义在节点上的特征函数，成为状态特征，只依赖于当前位置

一般来说，训练CRF模型的时候，就是在训练不同特征函数的权重。

和HMM模型做一个比较：

$$
p(l,s) = \overbrace{p(l_1)}^{起始概率} \prod_i \overbrace{p(l_i|l_{i-1})}^{转移概率} \overbrace{p(w_i|l_i)}^{发射概率}
$$

可见，CRF相较于HMM模型来说：

1. 能定义更多的特征函数，HMM由于天然的局限性，当前单词只和当前标签存在关系，当前标签只和上一个单词的标签存在关系。
2. 权重可以是任意值