# 雪花算法

## 介绍

雪花算法是开源的分布式ID生成算法，将64位划分为不同的段，每段代表不同的含义。

- 1是符号位，始终取0
- 2-42是时间戳，41位毫秒级别的时间戳能代表大概69年，代表的是开始时间顺推69年
- 43-52代表机器数，10位能代表1024台机器能在同一毫秒内同时生成id
- 53-64代表自增序列，12位能代表一台机器在同一毫秒内能生成4096个数

## 缺点

强依赖系统时钟，如果时钟回拨，就会导致发号重复或服务不可用。

## 变种算法

### 百度UidGenerator

和雪花算法的原理是一致的，只不过把默认的位分配的规则修改为：

- 1位符号位不变
- 28位时间戳，代表秒级时间戳
- 22位机器数，代表4194304个工作ID
- 13位自增序列，代表8192个数

位数分配规则可以在构造方法中指定。

百度的开源算法推荐一种环形缓存队列生成uid的办法，即CachedUidGenerator。

该生成器中有两个环形缓存队列，一个队列(tail)用于存储目前已经生成的可供读取的uid，一个队列(cursor)用于标识哪些tail队列的uid是供读取或已读取供更新的。

生成器会在一开始、定时的或每次取值的时候为两个队列填充。

缺点：

分布式环境下，不一定会按照时间顺序递增，因为uid是提前生成的。